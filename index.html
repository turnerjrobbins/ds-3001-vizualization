
<html>
<head>
    <title>Earthquakes </title>
    //<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>

    <style>
        body {
            position: absolute;
            text-align: center;
            font-family: "Proxima Nova", "Montserrat", sans-serif;
        }
        #sliderContainer {
            position: relative;
            top: 600px;
        }
        #title h1 {
            margin-bottom: 0px;
        }
        #title p {
            margin-top: 2px;
            margin-bottom: 0px;
        }
    </style>
</head>
<body>
    <div id="title">
        <h1>Earthquakes over the last 30 days</h1>
    </div>
    <div id="sliderContainer">
        <input id="timeslide" type="range" min="0" max="29" value="0" step="1"/><br>
        <span id="range"></span>
    </div>
    <script>
    //import the CSV
    d3.csv("/data/cities.csv", function(d) {
        return {
            time        : d.time;
            latitude    : +d.latitude;
            longitude   : +d.longitude;
            mag         : +d.mag;
        };
    }, function(data) {
        console.log(data[0]);
    });

    var width = 920;
    var height = 580;

    // set projection
    var projection = d3.geo.mercator();

    // create path variable
    var path = d3.geo.path()
        .projection(projection);

    d3.json("us.json", function(error, topo) { console.log(topo);

        states = topojson.feature(topo, topo.objects.states).features

        // set projection parameters
        projection
          .scale(1000)

    // when the input range changes update all points 
    d3.select("#timeslide").on("input", function() {
        update(+this.value);
    });

    // create svg variable
    var svg = d3.select("body").append("svg")
                    .attr("width", width)
                    .attr("height", height);

    // points
    aa = [-122.490402, 37.786453];
    bb = [-122.389809, 37.72728];

    console.log(projection(aa),projection(bb));

    // add states from topojson
    svg.selectAll("path")
      .data(states).enter()
      .append("path")
      .attr("class", "feature")
      .style("fill", "steelblue")
      .attr("d", path);

    // put boarder around states 
    svg.append("path")
      .datum(topojson.mesh(topo, topo.objects.states, function(a, b) { return a !== b; }))
      .attr("class", "mesh")
      .attr("d", path);

    // add circles to svg
    svg.selectAll("circle")
        .data([aa,bb]).enter()
        .append("circle")
        .attr("cx", function (d) { console.log(projection(d)); return projection(d)[0]; })
        .attr("cy", function (d) { return projection(d)[1]; })
        .attr("r", "8px")
        .attr("fill", "red")

});

    function update(value) {
        document.getElementById("range").innerHTML=time[value];
        inputValue = time[value];
        d3.selectAll("path")
            .style("fill", timeMatch);
    }

    function timeMatch(data) {
        if (inputValue == "2000") {
            if (data.properties.elect2000 == "D") {
                return '#084594'
            } else {
                return '#cb181d'
            }
        } else if (inputValue == "2004") {
            if (data.properties.elect2004 == "D") {
                return '#084594'
            } else {
                return '#cb181d'
            }
        } else if (inputValue == "2008") {
            if (data.properties.elect2008 == "D") {
                return '#084594'
            } else {
                return '#cb181d'
            }
        } else if (inputValue == "2012") {
            if (data.properties.elect2012 == "D") {
                return '#084594'
            } else {
                return '#cb181d'
            }
        } else if (inputValue == "2016") {
            if (data.properties.elect2016 == "D") {
                return '#084594'
            } else {
                return '#cb181d'
            }
        };
    }

    function initialState(data){
        if (document.getElementById("range").innerHTML == 2000) {
            if (data.properties.elect2000 == "D") {
                return '#084594'
            } else {
                return '#cb181d'
            }
        };
    }
    </script>
</body>
</html>